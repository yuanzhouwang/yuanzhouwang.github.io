<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 3</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="custom.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Andrew Wang</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">About</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    CS&amp;SS 321
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="teaching.html">Overview</a>
    </li>
    <li>
      <a href="lab1.html">Week 1</a>
    </li>
    <li>
      <a href="lab2.html">Week 2</a>
    </li>
    <li>
      <a href="lab3.html">Week 3</a>
    </li>
    <li>
      <a href="lab4.html">Week 4</a>
    </li>
    <li>
      <a href="lab5.html">Week 5</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Research
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="research.html">Papers</a>
    </li>
    <li>
      <a href="CV.html">CV</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Toys
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="simmodel.html">Protest-Repression Model</a>
    </li>
    <li>
      <a href="pdlparking.html">Should I Pay to Park in PDL?</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 3</h1>

</div>


<p>The R Markdown file for this lab can be found <a
href="https://github.com/yuanzhouwang/yzwang-teaching/blob/main/CSSS321%20Lab%203.Rmd">here</a>.</p>
<p>The potential outcomes framework is the standard approach to causal
inference. In this lab, we will learn how to apply this framework to
analyze research papers in our field, and hopefully gain an appreciation
for the power of this framework. We will also preview some important
mathematical basics to understanding how we can operationalize this
framework.</p>
<hr />
<div id="part-1" class="section level2">
<h2>Part 1</h2>
</div>
<div id="goals" class="section level1">
<h1>Goals</h1>
<p>By the end of this part, you should be able to:</p>
<ul>
<li>Identify <strong>treatment and outcome variables</strong>, as well
as treatment groups.</li>
<li>Explain how the potential outcomes framework contributes to valid
<strong>causal effects</strong>.</li>
<li>Find <strong>threats to validity</strong> based on the potential
outcomes framework.</li>
</ul>
<p>Please sort yourselves into <span class="math inline">\(3n\)</span>
groups, <span class="math inline">\(n \in \mathbb{N}\)</span>. Ideally,
you should join a group with others who have a major most similar to
yours. You will each be assigned a paper from the below:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Economics</strong>: <a
href="https://economics.mit.edu/sites/default/files/publications/colonial-origins-of-comparative-development.pdf?utm_source=chatgpt.com">Acemoglu,
Johnson &amp; Robinson (2001), “The Colonial Origins of Comparative
Development.” <em>American Economic Review</em>.</a></p></li>
<li><p><strong>Sociology</strong>: <a
href="https://scholar.harvard.edu/files/pager/files/pager_ajs.pdf?utm_source=chatgpt.com">Pager
(2003), “The Mark of a Criminal Record.” <em>American Journal of
Sociology</em>.</a></p></li>
<li><p><strong>Political Science</strong>: <a
href="https://emiguel.econ.berkeley.edu/wordpress/wp-content/uploads/2021/03/Paper__Economic_Shocks_and_Civil_Conflict.pdf">Miguel,
Satyanath &amp; Sergenti (2004), “Economic Shocks and Civil Conflict: An
Instrumental Variables Approach.” <em>Journal of Political
Economy</em>.</a></p></li>
</ol>
<p>Each group will discuss among themselves and present a 3-5 minute
summary as follows:</p>
<ul>
<li>What question are the authors trying to answer?</li>
<li>What is the treatment variable/treatment groups? What is the outcome
variable?</li>
<li>What are two potential threats to validity that the authors
address?</li>
<li>What is one potential threat to validity that the authors do not
address?</li>
<li>What is the authors’ answer to the question?</li>
</ul>
<hr />
<div id="part-2" class="section level2">
<h2>Part 2</h2>
</div>
</div>
<div id="goals-1" class="section level1">
<h1>Goals</h1>
<p>By the end of this part, you should be able to:</p>
<ul>
<li>Explain how <strong>random assignment</strong> enables causal
inference by making groups comparable on both observed and unobserved
factors.</li>
<li>Use <code>tapply()</code> to compute <strong>group-wise
means</strong> of baseline covariates.</li>
<li>Diagnose balance using <strong>mean differences</strong> and
<strong>standardized differences</strong>.</li>
<li>See why even with <em>weird</em> covariate distributions,
randomization tends to produce balanced groups <strong>on
average</strong>.</li>
<li>Visualize the randomization distribution of mean differences over
many re-assignments.</li>
</ul>
<p>Let’s start by simulating some data. You do not need to know how this
simulation works. Simply run the below code chunk and treat the
resulting data as you would any other dataset. For the sake of avoiding
too much abstraction at this stage, let’s consider the following fake
scenario:</p>
<hr />
<blockquote>
<p>The Department of Health wants to answer the following question: Does
watching short-form video media cause worse brain development among
children? We have enough funding to hire 600 test subjects, and no moral
qualms about humane treatment. We can measure whatever we need, but we
also have data on previous exposure, actual IQ, number of incidences of
academic probations, and sex (assume M/F).</p>
</blockquote>
<hr />
<pre class="r"><code>set.seed(2025)   # for reproducibility
N &lt;- 600         # number of observations

# (log-normal)
exposure &lt;- rlnorm(N, meanlog = 0, sdlog = 1.0)

# (Normal)
IQ &lt;- rnorm(N, mean = 95, sd = 15)

# (Bernoulli with p=0.49)
male &lt;- rbinom(N, 1, 0.49)

# Put into a data.frame
dat &lt;- data.frame(id = 1:N, exposure, IQ, male)
head(dat)</code></pre>
<pre><code>##   id exposure        IQ male
## 1  1 1.860335  82.22982    1
## 2  2 1.036284  72.25608    0
## 3  3 2.166590 110.43226    0
## 4  4 3.569727 129.51451    0
## 5  5 1.449147 105.63320    1
## 6  6 0.849715  96.15045    1</code></pre>
<p>You should now have a dataframe <code>dat</code>.</p>
</div>
<div id="identification-strategy" class="section level1">
<h1>Identification strategy</h1>
<p>How should we answer the question? Please identify:</p>
<ul>
<li>The treatment variable, and what treatment groups we need,</li>
<li>The outcome variable, and how we can measure it.</li>
<li>Are each of the variables we currently measure confounding
variables?</li>
</ul>
</div>
<div id="data-exploration" class="section level1">
<h1>Data exploration</h1>
<p>Let’s look at how each of the confounding variables is distributed
using <code>hist()</code>.</p>
<pre class="r"><code># [Your code here]
hist(dat$IQ)</code></pre>
<p><img src="lab3_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>hist(dat$exposure)</code></pre>
<p><img src="lab3_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code>hist(dat$male)</code></pre>
<p><img src="lab3_files/figure-html/unnamed-chunk-1-3.png" width="672" />
If we randomly assign individuals into treatment groups, what shape
should we expect for the within-group distributions of each
variable?</p>
</div>
<div id="randomization" class="section level1">
<h1>Randomization</h1>
<p>We now create a treatment indicator by flipping a fair coin for each
observation. You don’t need to know how to do this yet. Again, just run
the code chunk below.</p>
<pre class="r"><code># 50/50 assignment
group &lt;- sample(c(&quot;A&quot;,&quot;B&quot;), size = N, replace = TRUE)
dat$group &lt;- group

# Quick counts
table(dat$group)</code></pre>
<pre><code>## 
##   A   B 
## 280 320</code></pre>
<pre class="r"><code>prop.table(table(dat$group))</code></pre>
<pre><code>## 
##         A         B 
## 0.4666667 0.5333333</code></pre>
<p>Now create two subsets of <code>dat</code>.</p>
<pre class="r"><code># [Your code here]
dat_A &lt;- dat[dat$group==&quot;A&quot;, ]
dat_B &lt;- dat[dat$group==&quot;B&quot;, ]</code></pre>
<p>Plot the within-subset distributions for each variable. Do they look
the same? Are the two groups comparable?</p>
<pre class="r"><code># [Your code here]
hist(dat_A$IQ)</code></pre>
<p><img src="lab3_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>hist(dat_B$IQ)</code></pre>
<p><img src="lab3_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<p>Bonus: Let’s reduce the sample size <code>N</code>. Are the two
groups comparable now?</p>
<p>Bonus: In general, how can we assess whether our two groups are
comparable?</p>
</div>
<div id="covariate-balance" class="section level1">
<h1>Covariate Balance</h1>
<p>We will compute group means of each covariate using
<code>tapply()</code>, which we learned in class. Please calculate the
means of each variable for each subgroup. Name each as follows:
<code>mean_groupletter_variablename</code>.</p>
<pre class="r"><code># [Your code here]
mean_A_exposure &lt;- tapply(dat$exposure,dat$group,mean)[[&quot;A&quot;]]
mean_B_exposure &lt;- tapply(dat$exposure,dat$group,mean)[[&quot;B&quot;]]

mean_A_IQ &lt;- tapply(dat$IQ,dat$group,mean)[[&quot;A&quot;]]
mean_B_IQ &lt;- tapply(dat$IQ,dat$group,mean)[[&quot;B&quot;]]

mean_A_male &lt;- tapply(dat$male,dat$group,mean)[[&quot;A&quot;]]
mean_B_male &lt;- tapply(dat$male,dat$group,mean)[[&quot;B&quot;]]</code></pre>
<p>Let’s plot the above results. You don’t need to know how to do the
below yet.</p>
<pre class="r"><code>balance_table &lt;- data.frame(
  covariate = c(&quot;Exposure&quot;, &quot;IQ&quot;, &quot;Gender&quot;),
  mean_A = c(mean_A_exposure, mean_A_IQ, mean_A_male),
  mean_B = c(mean_B_exposure, mean_B_IQ, mean_B_male)
)
balance_table$diff_in_means &lt;- with(balance_table, mean_A - mean_B)
balance_table</code></pre>
<pre><code>##   covariate     mean_A    mean_B diff_in_means
## 1  Exposure  1.8242908  1.606882    0.21740922
## 2        IQ 95.9481691 93.691826    2.25634358
## 3    Gender  0.4928571  0.443750    0.04910714</code></pre>
<p>For each covariate, are the A and B means close? Explain why
randomization implies they should be close <strong>in
expectation</strong> even if any one draw shows some noise.</p>
</div>
<div id="randomization-as-simulated-counterfactuals"
class="section level1">
<h1>Randomization as simulated counterfactuals</h1>
<p>The <strong>potential outcomes</strong> for a unit <span
class="math inline">\(i\)</span> are <span
class="math inline">\(Y_i(A)\)</span> and <span
class="math inline">\(Y_i(B)\)</span>. Randomization picks one at random
to reveal. If groups are balanced on covariates and unobservables in
expectation, then comparing mean outcomes between A and B
<strong>estimates a causal effect</strong>.</p>
<p>We illustrate this by simulating an outcome <code>Y</code> that
depends on our covariates, but <strong>not</strong> on group
assignment.</p>
<pre class="r"><code># outcome depends on covariates (nonlinear), but not on group
Y &lt;- 1.5 + 0.4*log(1+exposure) + 0.6*(IQ &gt; 1.5) - 0.8*IQ + rnorm(N, 0, 0.7)
dat$Y &lt;- Y</code></pre>
<p>What is the difference in mean <code>Y</code> between A and B? What
would happen if assignment were correlated with one or more
covariates?</p>
<pre class="r"><code># [Your code here]</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
