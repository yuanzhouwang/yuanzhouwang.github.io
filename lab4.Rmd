---
title: "Lab 4: Correlations and Visualizations"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

# Install if needed
if (!requireNamespace("palmerpenguins", quietly = TRUE)) {
  install.packages("palmerpenguins")
}
if (!requireNamespace("ggplot2", quietly = TRUE)) {
  install.packages("ggplot2")
}
if (!requireNamespace("dplyr", quietly = TRUE)) {
  install.packages("dplyr")
}
library(palmerpenguins)
library(ggplot2)
library(dplyr)
```

# Dataset

We'll use the **palmerpenguins** dataset, which contains measurements for three penguin species (Adelie, Chinstrap, Gentoo) from the Palmer Archipelago, Antarctica. Key variables include:

- `species` (factor: Adelie, Chinstrap, Gentoo)  
- `island` (factor)  
- `bill_length_mm`, `bill_depth_mm`  
- `flipper_length_mm`  
- `body_mass_g`  
- `sex` (male/female, with some missing)  

We'll focus on **flipper length** (in millimeters) as the outcome of interest and compare across species.

```{r packages}
peng <- penguins
peng <- peng %>% filter(!is.na(flipper_length_mm)) # drop NAs in outcome when needed
```

# 1. What is the **average flipper length** among **Gentoo** penguins?

```{r}
# [Your Code Here]
```

# 2. What is the **average flipper length** among **Adelie** penguins?

```{r}
# [Your Code Here]
```

# 3. What is the estimated difference in average flipper length of **Gentoo vs Adelie**? Is this effect Causal?

```{r}
# [Your Code Here]
```


# 4. Visualize the distribution of `flipper_length_mm`. About how many observations are near **200 mm** (Â±5 mm)?

## Tidyverse (ggplot2) histogram
```{r}
ggplot(peng, aes(x = flipper_length_mm)) +
  geom_histogram(binwidth = 5, boundary = 0, closed = "left") +
  labs(title = "Distribution of Flipper Length", x = "Flipper length (mm)", y = "Count")
```

## Base R histogram
```{r}
hist(peng$flipper_length_mm, breaks = seq(floor(min(peng$flipper_length_mm, na.rm = TRUE)),
                                          ceiling(max(peng$flipper_length_mm, na.rm = TRUE)), by = 5),
     main = "Distribution of Flipper Length (base R)",
     xlab = "Flipper length (mm)")
```

## Count near 200 mm
### Tidyverse
```{r}
approx_200 <- peng %>% summarize(n = sum(abs(flipper_length_mm - 200) <= 5, na.rm = TRUE)) %>% pull(n)
approx_200
```

### Base R
```{r}
approx_200_base <- sum(abs(peng$flipper_length_mm - 200) <= 5, na.rm = TRUE)
approx_200_base
```

# 5. Explore the relationship between `flipper_length_mm` and `body_mass_g`. Does it look positive or negative?

## Tidyverse (ggplot2) scatter with trend
```{r}
ggplot(peng, aes(x = body_mass_g, y = flipper_length_mm, color = species)) +
  geom_point(na.rm = TRUE, alpha = 0.8) +
  geom_smooth(method = "lm", se = FALSE, na.rm = TRUE) +
  labs(title = "Flipper length vs Body mass", x = "Body mass (g)", y = "Flipper length (mm)")
```

## Base R scatter with fitted line
```{r}
plot(peng$body_mass_g, peng$flipper_length_mm,
     xlab = "Body mass (g)", ylab = "Flipper length (mm)",
     main = "Flipper length vs Body mass (base R)")
ok <- complete.cases(peng$body_mass_g, peng$flipper_length_mm)
abline(lm(flipper_length_mm ~ body_mass_g, data = peng[ok, ]))
```

# 6. Compute the correlation between `flipper_length_mm` and `body_mass_g`.

## Tidyverse
```{r q6-tidy}
corr_val <- cor(peng$flipper_length_mm, peng$body_mass_g, use = "complete.obs")
corr_val
```

## Base R
```{r q6-base}
corr_val_base <- cor(peng$flipper_length_mm, peng$body_mass_g, use = "complete.obs")
corr_val_base
```

**(a)** Are you surprised by the sign?
**(b)** Are you surprised by the absolute value (magnitude)?

# 7. If we wanted our estimates to generalize beyond the observed sample of penguins to all penguins of these two species, how should we select our sample?
